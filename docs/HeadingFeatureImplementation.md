# ユーザー方向表示機能の実装

## 実装日時
2025-07-24

## 実装内容

### 概要
ホーム画面の地図上で、ユーザーの現在位置に加えて**向いている方向（heading）**を扇形で表示する機能を実装しました。

### 変更ファイル

#### `/src/features/map/presentation/components/MapContainer.tsx`
- react-native-svgを使用して扇形の方向表示を追加
- headingデータがnullでない場合のみ扇形を表示
- 扇形は45度の角度で、半透明の青色で表示
- 現在位置のドットの下に扇形を配置（z-indexで制御）

### 実装の詳細

#### 1. 扇形の描画
```typescript
<Svg width="60" height="60" viewBox="0 0 60 60">
  <Path
    d="M 30 30 L 30 5 A 25 25 0 0 1 47.5 12.5 Z"
    fill="#007AFF"
    fillOpacity={0.3}
    stroke="#007AFF"
    strokeWidth="1"
    strokeOpacity={0.5}
  />
</Svg>
```
- 中心から45度の扇形を描画
- 半透明（opacity: 0.3）で視覚的な邪魔にならないよう配慮

#### 2. 方向の適用
```typescript
transform: [{ rotate: `${userLocation.coords.heading}deg` }]
```
- headingの値（0-360度）をそのまま回転角度として使用
- 北が0度、東が90度、南が180度、西が270度

#### 3. 条件付きレンダリング
```typescript
{userLocation.coords.heading !== null && (
  // 扇形の表示
)}
```
- headingがnullの場合は扇形を表示しない
- デバイスが方向情報を提供できない場合の対応

### 依存関係の追加

#### react-native-svg
```bash
npm install react-native-svg
```
- SVGを使用して扇形を描画するためのライブラリ
- iOS向けにpod installも実行済み

### デザインの特徴

1. **視認性**: 半透明の青色で地図の内容を隠さない
2. **一貫性**: 現在位置マーカーと同じ青色（#007AFF）を使用
3. **サイズ**: 60x60のコンテナで適度な大きさ
4. **角度**: 45度の扇形で方向を明確に表示

### 既存機能への影響

- 既存の位置情報表示機能に影響なし
- headingデータは既にLocationエンティティに定義済みのため、追加の変更不要
- expo-locationから自動的にheadingデータが取得される

### 今後の改善案

1. **扇形の角度を設定可能に**: 現在は45度固定だが、精度に応じて変更可能に
2. **色のカスタマイズ**: ユーザー設定で色を変更可能に
3. **アニメーション**: 方向変更時のスムーズなアニメーション
4. **精度表示**: headingの精度も視覚的に表現

## テスト方法

1. アプリを起動
2. 位置情報の許可を与える
3. デバイスを回転させて方向を変える
4. 地図上の扇形が回転することを確認

## 注意事項

- 一部のデバイスではheadingが取得できない場合があります
- シミュレーターではheadingが常にnullになる可能性があります
- 実機でのテストを推奨します